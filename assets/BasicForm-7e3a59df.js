var Me=Object.defineProperty;var we=Object.getOwnPropertySymbols;var Ye=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var Ie=(e,s,n)=>s in e?Me(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,C=(e,s)=>{for(var n in s||(s={}))Ye.call(s,n)&&Ie(e,n,s[n]);if(we)for(var n of we(s))He.call(s,n)&&Ie(e,n,s[n]);return e};var R=(e,s,n)=>new Promise((r,d)=>{var f=i=>{try{g(n.next(i))}catch(u){d(u)}},l=i=>{try{g(n.throw(i))}catch(u){d(u)}},g=i=>i.done?r(i.value):Promise.resolve(i.value).then(f,l);g((n=n.apply(e,s)).next())});import{h as Ue,d as $e,a as We,_ as qe}from"./FormItem.vue_vue_type_script_lang-60e73ebf.js";import{Q as ze,R as Ke,E as Ge,B as Xe,S as Ze,p as F,l as Je,_ as Ee,U as W,V as ee,n as le,q as ie,W as X,X as te,Y as Ae,Z as U,c as Z,O as Qe,u as Re,$ as Te,a0 as pe,d as Pe,h as xe}from"./index.js";import{y as Le,q as Ve,R as et}from"./antd-168c158e.js";import{d as ke,c as Y,a7 as q,Z as G,a8 as J,a9 as H,$ as tt,af as nt,l as ue,N as z,ac as ne,E as me,a0 as he,ab as re,ai as ce,u as o,g as ot,w as x,am as st,x as ve,H as je,h as at,r as De,f as Q,o as rt,ak as it,_ as ct,aa as ye,ad as Ce,aj as be,F as lt}from"./vue-ea98dac5.js";import{g as ge}from"./get-921f7259.js";import{i as ut}from"./isNumber-6e063d5c.js";import{i as ft}from"./isBoolean-e59585aa.js";import{u as dt}from"./uniqBy-989d5baf.js";import{u as pt}from"./index-567227c5.js";function Se(e,s){return e==null?!0:ze(e,s)}const Ne=Symbol();function mt(e){return Ge(e,Ne)}function ht(){return Ke(Ne)}const yt=ke({name:"BasicFormAction",components:{FormItem:Le.Item,Button:Xe,BasicArrow:Ze,[Ve.name]:Ve},props:{showActionButtonGroup:F.bool.def(!0),showResetButton:F.bool.def(!0),showSubmitButton:F.bool.def(!0),showAdvancedButton:F.bool.def(!0),resetButtonOptions:{type:Object,default:()=>({})},submitButtonOptions:{type:Object,default:()=>({})},actionColOptions:{type:Object,default:()=>({})},actionSpan:F.number.def(6),isAdvanced:F.bool,hideAdvanceBtn:F.bool},emits:["toggle-advanced"],setup(e,{emit:s}){const{t:n}=Je(),r=Y(()=>{const{showAdvancedButton:g,actionSpan:i,actionColOptions:u}=e,b=24-i,O=g?{span:b<6?24:b}:{};return C(C({style:{textAlign:"right"},span:g?6:4},O),u)}),d=Y(()=>Object.assign({text:n("common.resetText")},e.resetButtonOptions)),f=Y(()=>Object.assign({text:n("common.queryText")},e.submitButtonOptions));function l(){s("toggle-advanced")}return C({t:n,actionColOpt:r,getResetBtnOptions:d,getSubmitBtnOptions:f,toggleAdvanced:l},ht())}});function bt(e,s,n,r,d,f){const l=q("Button"),g=q("BasicArrow"),i=q("FormItem"),u=q("a-col");return e.showActionButtonGroup?(G(),J(u,ce(ne({key:0},e.actionColOpt)),{default:H(()=>[tt("div",{style:nt([{width:"100%"},{textAlign:e.actionColOpt.style.textAlign}])},[ue(i,null,{default:H(()=>[z(e.$slots,"resetBefore"),e.showResetButton?(G(),J(l,ne({key:0,type:"default",class:"mr-2"},e.getResetBtnOptions,{onClick:e.resetAction}),{default:H(()=>[me(he(e.getResetBtnOptions.text),1)]),_:1},16,["onClick"])):re("",!0),z(e.$slots,"submitBefore"),e.showSubmitButton?(G(),J(l,ne({key:1,type:"primary",class:"mr-2"},e.getSubmitBtnOptions,{onClick:e.submitAction}),{default:H(()=>[me(he(e.getSubmitBtnOptions.text),1)]),_:1},16,["onClick"])):re("",!0),z(e.$slots,"advanceBefore"),e.showAdvancedButton&&!e.hideAdvanceBtn?(G(),J(l,{key:2,type:"link",size:"small",onClick:e.toggleAdvanced},{default:H(()=>[me(he(e.isAdvanced?e.t("component.form.putAway"):e.t("component.form.unfold"))+" ",1),ue(g,{class:"ml-1",expand:!e.isAdvanced,up:""},null,8,["expand"])]),_:1},8,["onClick"])):re("",!0),z(e.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):re("",!0)}const At=Ee(yt,[["render",bt]]);function gt(e,s,n){const r=/^\[(.+)\]$/;if(r.test(e)){const d=e.match(r);if(d&&d[1]){const f=d[1].split(",");return s=Array.isArray(s)?s:[s],f.forEach((l,g)=>{X(n,l.trim(),s[g])}),!0}}}function vt(e,s,n){const r=/^\{(.+)\}$/;if(r.test(e)){const d=e.match(r);if(d&&d[1]){const f=d[1].split(",");return s=W(s)?s:{},f.forEach(l=>{X(n,l.trim(),s[l.trim()])}),!0}}}function Bt({defaultValueRef:e,getSchema:s,formModel:n,getProps:r}){function d(i){var b,O;if(!W(i))return{};const u={};for(const p of Object.entries(i)){let[,m]=p;const[I]=p;if(!I||ee(m)&&m.length===0||le(m))continue;const S=o(r).transformDateFunc;W(m)&&(m=S==null?void 0:S(m)),ee(m)&&((b=m[0])!=null&&b.format)&&((O=m[1])!=null&&O.format)&&(m=m.map(h=>S==null?void 0:S(h))),ie(m)&&(m===""?m=void 0:m=m.trim()),!gt(I,m,u)&&!vt(I,m,u)&&X(u,I,m)}return f(u)}function f(i){const u=o(r).fieldMapToTime;if(!u||!Array.isArray(u))return i;for(const[b,[O,p],m="YYYY-MM-DD"]of u){if(!b||!O||!p)continue;if(!ge(i,b)){Se(i,b);continue}const[I,S]=ge(i,b),[h,w]=Array.isArray(m)?m:[m,m];!te(I)&&!Ae(I)&&X(i,O,l(I,h)),!te(S)&&!Ae(S)&&X(i,p,l(S,w)),Se(i,b)}return i}function l(i,u){return u==="timestamp"?U(i).unix():u==="timestampStartDay"?U(i).startOf("day").unix():U(i).format(u)}function g(){const i=o(s),u={};i.forEach(b=>{const{defaultValue:O,defaultValueObj:p}=b,m=Object.keys(p||{});m.length&&m.map(I=>{u[I]=p[I],n[I]===void 0&&(n[I]=p[I])}),te(O)||(u[b.field]=O,n[b.field]===void 0&&(n[b.field]=O))}),e.value=Z(u)}return{handleFormValues:d,initDefault:g}}const K=24;function Ft({advanceState:e,emit:s,getProps:n,getSchema:r,formModel:d,defaultValueRef:f}){const l=ot(),{realWidthRef:g,screenEnum:i,screenRef:u}=Qe(),b=Y(()=>{if(!e.isAdvanced)return 0;const h=o(n).emptySpan||0;if(ut(h))return h;if(W(h)){const{span:w=0}=h,N=o(u);return h[N.toLowerCase()]||w||0}return 0}),O=Re(I,30);x([()=>o(r),()=>e.isAdvanced,()=>o(g)],()=>{const{showAdvancedButton:h}=o(n);h&&O()},{immediate:!0});function p(h,w=0,N=!1){const k=o(g),P=parseInt(h.md)||parseInt(h.xs)||parseInt(h.sm)||h.span||K,$=parseInt(h.lg)||P,_=parseInt(h.xl)||$,M=parseInt(h.xxl)||_;return k<=i.LG?w+=P:k<i.XL?w+=$:k<i.XXL?w+=_:w+=M,N?(e.hideAdvanceBtn=!1,w<=K*2?(e.hideAdvanceBtn=!0,e.isAdvanced=!0):w>K*2&&w<=K*(o(n).autoAdvancedLine||3)?e.hideAdvanceBtn=!1:e.isLoad||(e.isLoad=!0,e.isAdvanced=!e.isAdvanced),{isAdvanced:e.isAdvanced,itemColSum:w}):w>K*(o(n).alwaysShowLines||1)?{isAdvanced:e.isAdvanced,itemColSum:w}:{isAdvanced:!0,itemColSum:w}}const m=st({});function I(){var k;let h=0,w=0;const{baseColProps:N={}}=o(n);for(const P of o(r)){const{show:$,colProps:_}=P;let M=!0;if(ft($)&&(M=$),le($)&&(M=$({schema:P,model:d,field:P.field,values:C(C({},o(f)),d)})),M&&(_||N)){const{itemColSum:t,isAdvanced:a}=p(C(C({},N),_),h);h=t||0,a&&(w=h),m[P.field]=a}}(k=l==null?void 0:l.proxy)==null||k.$forceUpdate(),e.actionSpan=w%K+o(b),p(o(n).actionColOptions||{span:K},h,!0),s("advanced-change")}function S(){e.isAdvanced=!e.isAdvanced}return{handleToggleAdvanced:S,fieldsIsAdvancedMap:m}}function Ot(e,s={}){const n=/^\[(.+)\]$/;if(n.test(e)){const r=e.match(n);if(r&&r[1]){const d=r[1].split(",");if(!d.length)return;const f=[];return d.forEach((l,g)=>{X(f,g,s[l.trim()])}),f.filter(Boolean).length?f:void 0}}}function wt(e,s={}){const n=/^\{(.+)\}$/;if(n.test(e)){const r=e.match(n);if(r&&r[1]){const d=r[1].split(",");if(!d.length)return;const f={};return d.forEach(l=>{X(f,l.trim(),s[l.trim()])}),Object.values(f).filter(Boolean).length?f:void 0}}}function It({emit:e,getProps:s,formModel:n,getSchema:r,defaultValueRef:d,formElRef:f,schemaRef:l,handleFormValues:g}){function i(){return R(this,null,function*(){const{resetFunc:t,submitOnReset:a}=o(s);t&&le(t)&&(yield t()),o(f)&&(Object.keys(n).forEach(c=>{const A=o(r).find(D=>D.field===c),B=A==null?void 0:A.defaultValueObj,j=Object.keys(B||{});j.length&&j.map(D=>{n[D]=B[D]}),n[c]=Tt(A,d,c)}),ve(()=>$()),e("reset",je(n)),a&&M())})}const u=()=>o(r).map(t=>[...t.fields||[],t.field]).flat(1).filter(Boolean);function b(t){return R(this,null,function*(){if(Object.keys(t).length===0)return;const a=u(),v=".",c=a.filter(B=>String(B).indexOf(v)>=0),A=[];a.forEach(B=>{const j=o(r).find(T=>T.field===B);let D=ge(t,B);const fe=Reflect.has(t,B);D=Ue(j==null?void 0:j.component,D);const{componentProps:oe}=j||{};let L=oe;typeof oe=="function"&&(L=L({formModel:o(n)}));const se=Ot(B,t)||wt(B,t);if(fe||se){const T=se||D;if(N(B))if(Array.isArray(T)){const y=[];for(const V of T)y.push(V?U(V):null);o(n)[B]=y}else o(n)[B]=T?L!=null&&L.valueFormat?T:U(T):null;else o(n)[B]=T;L!=null&&L.onChange&&(L==null||L.onChange(T)),A.push(B)}else c.forEach(T=>{try{const y=T.split(".").reduce((V,E)=>V[E],t);Te(y)&&(o(n)[T]=o(y),A.push(T))}catch(y){Te(d.value[T])&&(o(n)[T]=Z(o(d.value[T])))}})}),k(A).catch(B=>{})})}function O(t){return R(this,null,function*(){const a=Z(o(r));if(!t)return;let v=ie(t)?[t]:t;ie(t)&&(v=[t]);for(const c of v)p(c,a);l.value=a})}function p(t,a){if(ie(t)){const v=a.findIndex(c=>c.field===t);v!==-1&&(delete n[t],a.splice(v,1))}}function m(t,a,v=!1){return R(this,null,function*(){const c=Z(o(r)),A=Array.isArray(t)?t.map(D=>D.field):[t.field];if(c.find(D=>A.includes(D.field))){pe("There are schemas that have already been added");return}const B=c.findIndex(D=>D.field===a),j=W(t)?[t]:t;!a||B===-1||v?v?c.unshift(...j):c.push(...j):B!==-1&&c.splice(B+1,0,...j),l.value=c,h(t)})}function I(t){return R(this,null,function*(){let a=[];if(W(t)&&a.push(t),ee(t)&&(a=[...t]),!a.every(c=>c.component==="Divider"||Reflect.has(c,"field")&&c.field)){pe("All children of the form Schema array that need to be updated must contain the `field` field");return}l.value=a})}function S(t){return R(this,null,function*(){let a=[];if(W(t)&&a.push(t),ee(t)&&(a=[...t]),!a.every(A=>A.component==="Divider"||Reflect.has(A,"field")&&A.field)){pe("All children of the form Schema array that need to be updated must contain the `field` field");return}const c=[];o(r).forEach(A=>{let B;if(a.forEach(j=>{A.field===j.field&&(B=j)}),B!==void 0&&A.field===B.field){const j=Pe(A,B);c.push(j)}else c.push(A)}),h(c),l.value=dt(c,"field")})}function h(t){let a=[];W(t)&&a.push(t),ee(t)&&(a=[...t]);const v={},c=w();a.forEach(A=>{A.component!="Divider"&&Reflect.has(A,"field")&&A.field&&!te(A.defaultValue)&&(!(A.field in c)||te(c[A.field])||Ae(c[A.field]))&&(v[A.field]=A.defaultValue)}),b(v)}function w(){return o(f)?g(je(o(n))):{}}function N(t){return o(r).some(a=>a.field===t&&a.component?$e.includes(a.component):!1)}function k(t){return R(this,null,function*(){var v;const a=yield(v=o(f))==null?void 0:v.validateFields(t);return g(a)})}function P(t){return R(this,null,function*(){var c;let a;t===void 0?a=u():a=t===Array.isArray(t)?t:void 0;const v=yield(c=o(f))==null?void 0:c.validate(a);return g(v)})}function $(t){return R(this,null,function*(){var a;yield(a=o(f))==null?void 0:a.clearValidate(t)})}function _(t,a){return R(this,null,function*(){var v;yield(v=o(f))==null?void 0:v.scrollToField(t,a)})}function M(t){return R(this,null,function*(){t&&t.preventDefault();const{submitFunc:a}=o(s);if(a&&le(a)){yield a();return}if(o(f))try{const c=yield P();e("submit",c)}catch(c){if((c==null?void 0:c.outOfDate)===!1&&(c!=null&&c.errorFields))return;throw new Error(c)}})}return{handleSubmit:M,clearValidate:$,validate:P,validateFields:k,getFieldsValue:w,updateSchema:S,resetSchema:I,appendSchemaByField:m,removeSchemaByField:O,resetFields:i,setFieldsValue:b,scrollToField:_}}function Tt(e,s,n){let r=Z(s.value[n]);return jt(e)?r||"":(!r&&e&&Vt(e)&&(r=[0,0]),!r&&e&&e.component==="ApiTree"&&(r=[]),r)}function Vt(e){if(e.component==="Slider"&&e.componentProps&&"range"in e.componentProps)return!0}function jt(e){return(e==null?void 0:e.component)&&We.includes(e.component)}function Dt(d){return R(this,arguments,function*({getSchema:e,getProps:s,formElRef:n,isInitedDefault:r}){at(()=>R(this,null,function*(){if(o(r)||!o(s).autoFocusFirstItem)return;yield ve();const f=o(e),l=o(n),g=l==null?void 0:l.$el;if(!l||!g||!f||f.length===0)return;const i=f[0];if(!i.component||!i.component.includes("Input"))return;const u=g.querySelector(".ant-row:first-child input");u&&(u==null||u.focus())}))})}const Ct={model:{type:Object,default:()=>({})},labelWidth:{type:[Number,String],default:0},fieldMapToTime:{type:Array,default:()=>[]},compact:F.bool,schemas:{type:Array,default:()=>[]},mergeDynamicData:{type:Object,default:null},baseRowStyle:{type:Object},baseColProps:{type:Object},autoSetPlaceHolder:F.bool.def(!0),autoSubmitOnEnter:F.bool.def(!1),submitOnReset:F.bool,submitOnChange:F.bool,size:F.oneOf(["default","small","large"]).def("default"),disabled:F.bool,emptySpan:{type:[Number,Object],default:0},showAdvancedButton:F.bool,transformDateFunc:{type:Function,default:e=>{var s,n;return(n=(s=e==null?void 0:e.format)==null?void 0:s.call(e,"YYYY-MM-DD HH:mm:ss"))!=null?n:e}},rulesMessageJoinLabel:F.bool.def(!0),autoAdvancedLine:F.number.def(3),alwaysShowLines:F.number.def(1),showActionButtonGroup:F.bool.def(!0),actionColOptions:Object,showResetButton:F.bool.def(!0),autoFocusFirstItem:F.bool,resetButtonOptions:Object,showSubmitButton:F.bool.def(!0),submitButtonOptions:Object,resetFunc:Function,submitFunc:Function,hideRequiredMark:F.bool,labelCol:Object,layout:F.oneOf(["horizontal","vertical","inline"]).def("horizontal"),tableAction:{type:Object},wrapperCol:Object,colon:F.bool,labelAlign:F.string,rowProps:Object},St=ke({name:"BasicForm",components:{FormItem:qe,Form:Le,Row:et,FormAction:At},props:Ct,emits:["advanced-change","reset","submit","register","field-value-change"],setup(e,{emit:s,attrs:n}){const r=De({}),d=pt(),f=De({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),l=Q({}),g=Q(!1),i=Q(),u=Q(null),b=Q(null),{prefixCls:O}=xe("basic-form"),p=Y(()=>C(C({},e),o(i))),m=Y(()=>[O,{[`${O}--compact`]:o(p).compact}]),I=Y(()=>{const{baseRowStyle:y={},rowProps:V}=o(p);return C({style:y},V)}),S=Y(()=>C(C(C({},n),e),o(p))),h=Y(()=>{const y=o(u)||o(p).schemas;for(const V of y){const{defaultValue:E,component:de,componentProps:Be,isHandleDateDefaultValue:_e=!0}=V;if(_e&&E&&de&&$e.includes(de)){const ae=Be?Be.valueFormat:null;if(!Array.isArray(E))V.defaultValue=ae?U(E).format(ae):U(E);else{const Fe=[];E.forEach(Oe=>{Fe.push(ae?U(Oe).format(ae):U(Oe))}),V.defaultValue=Fe}}}return o(p).showAdvancedButton?Z(y.filter(V=>V.component!=="Divider")):Z(y)}),{handleToggleAdvanced:w,fieldsIsAdvancedMap:N}=Ft({advanceState:f,emit:s,getProps:p,getSchema:h,formModel:r,defaultValueRef:l}),{handleFormValues:k,initDefault:P}=Bt({getProps:p,defaultValueRef:l,getSchema:h,formModel:r});Dt({getSchema:h,getProps:p,isInitedDefault:g,formElRef:b});const{handleSubmit:$,setFieldsValue:_,clearValidate:M,validate:t,validateFields:a,getFieldsValue:v,updateSchema:c,resetSchema:A,appendSchemaByField:B,removeSchemaByField:j,resetFields:D,scrollToField:fe}=It({emit:s,getProps:p,formModel:r,getSchema:h,defaultValueRef:l,formElRef:b,schemaRef:u,handleFormValues:k});mt({resetAction:D,submitAction:$}),x(()=>o(p).model,()=>{const{model:y}=o(p);y&&_(y)},{immediate:!0}),x(()=>o(p).schemas,y=>{A(y!=null?y:[])}),x(()=>h.value,y=>{ve(()=>{var V;(V=d==null?void 0:d.redoModalHeight)==null||V.call(d)}),!o(g)&&y!=null&&y.length&&(P(),g.value=!0)}),x(()=>r,Re(()=>{o(p).submitOnChange&&$()},300),{deep:!0});function oe(y){return R(this,null,function*(){i.value=Pe(o(i)||{},y)})}function L(y,V,E){r[y]=V,s("field-value-change",y,V),E&&E.itemProps&&!E.itemProps.autoLink&&a([y]).catch(de=>{})}function se(y){const{autoSubmitOnEnter:V}=o(p);if(V&&y.key==="Enter"&&y.target&&y.target instanceof HTMLElement){const E=y.target;E&&E.tagName&&E.tagName.toUpperCase()=="INPUT"&&$()}}const T={getFieldsValue:v,setFieldsValue:_,resetFields:D,updateSchema:c,resetSchema:A,setProps:oe,removeSchemaByField:j,appendSchemaByField:B,clearValidate:M,validateFields:a,validate:t,submit:$,scrollToField:fe};return rt(()=>{P(),s("register",T)}),C({getBindValue:S,handleToggleAdvanced:w,handleEnterPress:se,formModel:r,defaultValueRef:l,advanceState:f,getRow:I,getProps:p,formElRef:b,getSchema:h,formActionType:T,setFormModel:L,getFormClass:m,getFormActionBindProps:Y(()=>C(C({},p.value),f)),fieldsIsAdvancedMap:N},T)}});function $t(e,s,n,r,d,f){const l=q("FormItem"),g=q("FormAction"),i=q("Row"),u=q("Form");return G(),J(u,ne(e.getBindValue,{class:e.getFormClass,ref:"formElRef",model:e.formModel,onKeypress:it(e.handleEnterPress,["enter"])}),{default:H(()=>[ue(i,ce(be(e.getRow)),{default:H(()=>[z(e.$slots,"formHeader"),(G(!0),ct(lt,null,ye(e.getSchema,b=>(G(),J(l,{key:b.field,isAdvanced:e.fieldsIsAdvancedMap[b.field],tableAction:e.tableAction,formActionType:e.formActionType,schema:b,formProps:e.getProps,allDefaultValues:e.defaultValueRef,formModel:e.formModel,setFormModel:e.setFormModel},Ce({_:2},[ye(Object.keys(e.$slots),O=>({name:O,fn:H(p=>[z(e.$slots,O,ce(be(p||{})))])}))]),1032,["isAdvanced","tableAction","formActionType","schema","formProps","allDefaultValues","formModel","setFormModel"]))),128)),ue(g,ne(e.getFormActionBindProps,{onToggleAdvanced:e.handleToggleAdvanced}),Ce({_:2},[ye(["resetBefore","submitBefore","advanceBefore","advanceAfter"],b=>({name:b,fn:H(O=>[z(e.$slots,b,ce(be(O||{})))])}))]),1040,["onToggleAdvanced"]),z(e.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"])}const Ut=Ee(St,[["render",$t]]);export{Ut as B};
